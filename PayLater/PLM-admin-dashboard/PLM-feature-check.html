
<div id="test-containers" style="position: absolute; visibility: hidden; width: 1px; height: 1px; overflow: hidden;"></div>

<!-- <script src="https://www.paypal.com/sdk/js?client-id=AVmKF-CgqAXcDEMvjXUnw1kR-z9kwv-jl2Gc0uR45EwoW2QUk9FcAReTqLn15NvKkCWHIC2FddzS2dYe&components=messages"></script> -->
<script src="https://www.paypal.com/sdk/js?client-id=AZzRp3LalDO6KnI67OauLv0eFHjBq0TQJ7VpQK4M60B05SsPf-WB_nbh4DJraygQzf3B4ZLJGA2Uv0aZ&components=messages"></script>

<script>
    
    const countryList = ['US', 'GB', 'DE', 'FR', 'IT', 'ES', 'AU', 'CA'];

    /**
     * æ£€æµ‹å•ä¸ªå›½å®¶çš„ PayLater Message æ˜¯å¦èƒ½æ¸²æŸ“
     * @param {string} country 
     */
    function checkCountry(country) {
        return new Promise((resolve) => {
            // 1. åŠ¨æ€åˆ›å»ºä¸€ä¸ªå®¹å™¨
            const containerId = `pp-msg-${country}`;
            const div = document.createElement('div');
            div.id = containerId;
            document.getElementById('test-containers').appendChild(div);

            let isResolved = false;

            // 2. è¶…æ—¶ä¿æŠ¤ï¼šå¦‚æœ 5ç§’å†…æ²¡æœ‰ onRenderï¼Œè®¤ä¸ºå¤±è´¥ï¼ˆæˆ–ä¸æ”¯æŒï¼‰
            const timer = setTimeout(() => {
                if (!isResolved) {
                    isResolved = true;
                    resolve({ country, success: false, reason: 'Timeout (Not Rendered)' });
                    console.log(`âš ï¸ [${country}] Detection Timed out`);
                }
            }, 5000);

            // 3. è°ƒç”¨ SDK æ¸²æŸ“
            try {
                if (!window.paypal || !window.paypal.Messages) {
                    throw new Error("SDK not ready");
                }

                paypal.Messages({
                    buyerCountry: country,
                    placement: "product",
                   
                    
                    // æˆåŠŸå›è°ƒ
                    onRender: function() {
                        if (!isResolved) {
                            isResolved = true;
                            clearTimeout(timer);
                            resolve({ country, success: true, reason: 'Rendered' });
                            console.log(`âœ… [${country}] Supported & Rendered`);
                        }
                    }
                })
                .render(`#${containerId}`)
                .catch((err) => {
                    // SDK æ˜ç¡®æŠ¥é”™
                    if (!isResolved) {
                        isResolved = true;
                        clearTimeout(timer);
                        resolve({ country, success: false, reason: err.message || 'Render Error' });
                        console.error(`âŒ [${country}] Error:`, err);
                    }
                });
            } catch (e) {
                // ä»£ç æ‰§è¡Œé”™è¯¯
                if (!isResolved) {
                    isResolved = true;
                    clearTimeout(timer);
                    resolve({ country, success: false, reason: e.message || 'Script Error' });
                }
            }
        });
    }

    // ä¸»æ‰§è¡Œé€»è¾‘
    (async function runTests() {
        console.log('ğŸš€ Starting Country Check for:', countryList);
        
        if (!window.paypal) {
            console.error("PayPal SDK failed to load entirely.");
            return;
        }

      
        try {
            const results = await Promise.all(countryList.map(item => checkCountry(item)));
            
            console.log('--------------------------------------------------');
            console.log('ğŸ Final Report:');
            console.table(results);
            console.log('--------------------------------------------------');
            
        } catch (err) {
            console.error("Test suite error", err);
        } finally {
            // æµ‹è¯•ç»“æŸï¼Œè¿˜åŸ consoleï¼Œé¿å…å½±å“å…¶ä»–é€»è¾‘
            restoreConsole();
        }
    })();
</script>